generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// --- Coaching Platform Enums ---

enum ExperienceLevel {
  beginner
  intermediate
  advanced
}

enum PrescriptionType {
  percentage
  rpe
  rir
  velocity
  autoregulated
  fixed
}

enum WeightUnit {
  kg
  lbs
}

enum ProgramType {
  individual
  template
  group
}

enum PeriodizationType {
  block
  dup
  linear
  rpe_based
  hybrid
}

// --- Existing Models ---

model Submission {
  id             String   @id @default(uuid())
  generatedAt    DateTime
  trainerProfile Json
  sections       Json
  rawAnswers     Json
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

// --- Coaching Platform Models ---

model Coach {
  id        String   @id @default(uuid())
  name      String
  email     String   @unique
  brandName String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  athletes  Athlete[]
  programs  Program[]
  exercises Exercise[]
}

model Athlete {
  id              String          @id @default(uuid())
  coachId         String
  name            String
  email           String?
  bodyweight      Float?
  weightClass     String?
  experienceLevel ExperienceLevel @default(intermediate)
  isRemote        Boolean         @default(true)
  isCompetitor    Boolean         @default(false)
  federation      String?
  notes           String?         @db.Text
  metadata        Json?
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt

  coach Coach @relation(fields: [coachId], references: [id])

  programAssignments ProgramAssignment[]
  setLogs            SetLog[]
}

model Program {
  id                String            @id @default(uuid())
  coachId           String
  name              String
  description       String?           @db.Text
  type              ProgramType       @default(individual)
  periodizationType PeriodizationType?
  startDate         DateTime?
  endDate           DateTime?
  isTemplate        Boolean           @default(false)
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt

  coach       Coach                @relation(fields: [coachId], references: [id])
  workouts    Workout[]
  assignments ProgramAssignment[]
}

model ProgramAssignment {
  id         String    @id @default(uuid())
  programId  String
  athleteId  String
  assignedAt DateTime  @default(now())
  startDate  DateTime?
  endDate    DateTime?

  program Program @relation(fields: [programId], references: [id], onDelete: Cascade)
  athlete Athlete @relation(fields: [athleteId], references: [id], onDelete: Cascade)
}

model Workout {
  id         String   @id @default(uuid())
  programId  String
  name       String
  dayNumber  Int
  weekNumber Int
  notes      String?  @db.Text
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  program   Program           @relation(fields: [programId], references: [id], onDelete: Cascade)
  exercises WorkoutExercise[]
}

model Exercise {
  id        String   @id @default(uuid())
  coachId   String
  name      String
  category  String
  videoUrl  String?
  cues      String?  @db.Text
  tags      Json     @default("[]")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  coach            Coach             @relation(fields: [coachId], references: [id])
  workoutExercises WorkoutExercise[]
}

model WorkoutExercise {
  id               String           @id @default(uuid())
  workoutId        String
  exerciseId       String
  order            Int
  prescriptionType PrescriptionType @default(fixed)
  prescribedSets   String?
  prescribedReps   String?
  prescribedLoad   String?
  prescribedRPE    Float?
  prescribedRIR    Int?
  velocityTarget   Float?
  percentageOf1RM  Float?
  notes            String?          @db.Text

  workout  Workout  @relation(fields: [workoutId], references: [id], onDelete: Cascade)
  exercise Exercise @relation(fields: [exerciseId], references: [id])
  setLogs  SetLog[]
}

model SetLog {
  id                String     @id @default(uuid())
  workoutExerciseId String
  athleteId         String
  setNumber         Int
  reps              Int
  weight            Float
  unit              WeightUnit @default(lbs)
  rpe               Float?
  rir               Int?
  velocity          Float?
  completedAt       DateTime   @default(now())
  notes             String?    @db.Text

  workoutExercise WorkoutExercise @relation(fields: [workoutExerciseId], references: [id], onDelete: Cascade)
  athlete         Athlete         @relation(fields: [athleteId], references: [id], onDelete: Cascade)
}
